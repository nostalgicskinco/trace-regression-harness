name: Trace Regression Check
on:
  workflow_call:
    inputs:
      trace-file:
        description: 'Path to OTLP JSON trace export'
        required: true
        type: string
      policy-file:
        description: 'Path to policy JSON file'
        required: true
        type: string

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-go@v5
        with:
          go-version: '1.22'

      - name: Build tracecheck
        run: go build -o tracecheck ./cmd/tracecheck

      - name: Run trace regression check
        run: |
          ./tracecheck \
            -trace "${{ inputs.trace-file }}" \
            -policy "${{ inputs.policy-file }}" \
            -format text
